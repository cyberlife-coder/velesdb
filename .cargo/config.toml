[alias]
lint = "clippy --all-targets --all-features -- -D warnings"
test-all = "test --all-features"

# =============================================================================
# Python Environment for PyO3 tests (Windows)
# =============================================================================
# Required for velesdb-python tests to find Python standard library
[env]
PYTHONHOME = { value = "D:\\Tools\\pinokio\\bin\\miniconda", force = false }
PYTHONPATH = { value = "D:\\Tools\\pinokio\\bin\\miniconda\\Lib", force = false }

# =============================================================================
# Multi-Architecture Build Configuration (SOTA 2026)
# =============================================================================
# VelesDB supports multiple target architectures with optimized SIMD:
#
# | Target           | SIMD        | Build Command                            |
# |------------------|-------------|------------------------------------------|
# | x86_64-pc-windows| AVX2/AVX-512| cargo build --release                    |
# | x86_64-unknown-linux| AVX2/AVX-512| cargo build --release --target x86_64-unknown-linux-gnu |
# | aarch64-apple-darwin| NEON     | cargo build --release --target aarch64-apple-darwin |
# | aarch64-unknown-linux| NEON    | cargo build --release --target aarch64-unknown-linux-gnu |
# =============================================================================

# x86_64 optimizations (Windows/Linux)
[target.x86_64-pc-windows-msvc]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

[target.x86_64-pc-windows-gnu]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

[target.x86_64-unknown-linux-gnu]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

[target.x86_64-unknown-linux-musl]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

# macOS x86_64 (Intel Macs)
[target.x86_64-apple-darwin]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

# ARM64/aarch64 optimizations (Apple Silicon, ARM servers)
[target.aarch64-apple-darwin]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

[target.aarch64-unknown-linux-gnu]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

[target.aarch64-unknown-linux-musl]
rustflags = ["-C", "target-cpu=native", "-C", "opt-level=3"]

# =============================================================================
# Portable builds (no native CPU detection, for distribution)
# Use: RUSTFLAGS="-C target-cpu=x86-64-v3" cargo build --release
# =============================================================================
# x86-64-v2: SSE4.2 (2008+)
# x86-64-v3: AVX2 (2013+) - recommended baseline
# x86-64-v4: AVX-512 (2017+)

# Build profiles
[profile.release]
lto = "thin"
codegen-units = 1
panic = "abort"

[profile.release-with-debug]
inherits = "release"
debug = true

# Benchmark profile (fast iteration)
[profile.bench]
lto = false
codegen-units = 16
