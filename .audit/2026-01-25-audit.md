# VelesDB Core â€“ Audit QualitÃ© & DÃ©pendances (25 janv. 2026)

## 1. SynthÃ¨se exÃ©cutive

- **Codebase** : 18 crates Rust + plugins (Python, WASM, Tauri, CLI, Mobile)
- **Tests** : 1 910 tests Rust, 82 tests Python, 11 tests Playwright â€“ **100 % verts**
- **QualitÃ©** : `cargo fmt`, `clippy -D warnings`, `cargo deny` sans advisory
- **Branches** : repo nettoyÃ© â†’ *main* unique
- **EPICs** : Core done 22, En cours 1 (EPIC-011 83 %), Backlog 16

## 2. DÃ©pendances externes (Cargo.lock)

| Crate | Version | Notes |
|-------|---------|-------|
| `tokio` | 1.37 | Runtime async â€“ OK |
| `parking_lot` | 0.12 | Locks rapides â€“ OK |
| `memmap2` | 0.9 | Memory-map â€“ OK |
| `pyo3` | 0.24 | Python bindings â€“ OK |
| `wasm-bindgen` | 0.2 | WASM â€“ OK |
| `tauri` | 2.9 | Desktop plugin â€“ **beta** (surveiller breaking) |
| `uniffi` | 0.28 | Mobile bindings (epic-036) |

### Doublons dÃ©tectÃ©s (`cargo deny`)

| Crate | Versions | Impact |
|-------|----------|--------|
| `cargo_metadata` | 0.15.4 / 0.19.2 | +40 Ko binaire, build time |
| `convert_case` | 0.4 / 0.6 | mineur |
| `thiserror` | 1.0 / 2.0 | **risque** incohÃ©rence trait `Error` |

â¡ï¸ *Action* : aligner versions (`cargo upgrade --workspace` + features pruning).

## 3. DÃ©pendances internes (Graph)

```
velesdb-core
 â”œâ”€â”€ velesdb-server
 â”‚   â”œâ”€â”€ velesdb-cli
 â”‚   â”œâ”€â”€ velesdb-wasm
 â”‚   â”œâ”€â”€ tauri-plugin-velesdb
 â”‚   â””â”€â”€ velesdb-mobile (placeholder)
 â””â”€â”€ integrations/
     â”œâ”€â”€ langchain
     â””â”€â”€ llamaindex
```

- **SDK parity tracker** : EPIC-016 (3/6 US done)
- **Risk** : divergence TS & Mobile (mobile inexistant)

## 4. Analyse EPICs vs code

| EPIC (non-done) | Ã‰cart ObservÃ© |
|-----------------|---------------|
| EPIC-017 Aggregations | Parser/executor ne gÃ¨re pas `COUNT/SUM`. Aucun test. |
| EPIC-018 Documentation | Guides incomplets (10 use-cases manquants). |
| EPIC-032 Safety Hardening | Memory allocator raw ptr (ContiguousVectors). |
| EPIC-036 Mobile SDK | UniFFI scaffolding absent. |

## 5. Hotspots & Flags critiques

1. **Raw allocator** `perf_optimizations.rs` â€“ `alloc/dealloc` direct.
   *Risque *: double-free si panic dans `resize()`.
2. **Blocking I/O** `storage/mmap.rs` dans path async (serveur utilise sync, OK mais doc bogus).
3. **Duplicate crate `thiserror`** â€“ ABI mismatch possible.
4. **Large test files** (>750 lignes) â€“ lisibilitÃ©.
5. **Cargo features explosion** â€“ compile time (45 min CI cold).

## 6. Recommandations immÃ©diates (next 72 h)

| ğŸ· | TÃ¢che | Owner | Priority | Status |
|----|-------|-------|----------|--------|
| SEC-1 | Aligner `thiserror` vers 2.0 | Cascade | ğŸ”¥ | âœ… PR #105 mergÃ© â†’ develop, PR #106 pending review |
| PERF-1 | Refactor `ContiguousVectors` | - | ğŸ”¥ | âœ… DÃ©jÃ  mitigÃ© (AllocGuard RAII) |
| DX-1 | Extraire `api_integration.rs` (1853 lignes) | - | âš ï¸ | ğŸ”´ TODO (complexitÃ© Ã©levÃ©e) |
| DOC-1 | ComplÃ©ter guide `getting-started.md` | Tech Writer | âš ï¸ | ğŸ”´ TODO |

## 7. Plan dâ€™action 5 cycles (21 experts)

| Cycle | Focus | Responsables |
|-------|-------|--------------|
| #1 | Dependency alignment (`cargo hack`, duplicates) | Build WG |
| #2 | Memory allocator rewrite + Miri tests | Safety WG |
| #3 | Blocking-IO audit + spawn_blocking wrappers | Concurrency WG |
| #4 | Documentation EPIC-018 US-001/002 | Docs Squad |
| #5 | SDK Ecosystem sync matrix update | SDK WG |

## 8. Conclusion

Main est **stable** mais plusieurs risques modÃ©rÃ©s :
- Doublons crates âœ maintenance & bloat
- Allocateur manuel âœ UB potentiel
- Docs & SDK parity âœ adoption freinÃ©e

Corriger SEC-1 & PERF-1 en prioritÃ©, puis lancer EPIC-017 pour dÃ©bloquer docs.
